# 绪论

当下的医学图像识别、分割和解析方法主要关注以下几个方面：
- 解剖标志。解剖标志是身体扫描中与解剖结构一致的不同点，例如肝顶部、主动脉弓、耻骨联合等。
- 主要器官。主要器官的例子包括肝、肺、肾、脾、前列腺、膀胱、直肠等。
- 主要骨骼。主要骨骼的例子包括肋骨、椎骨、骨盆、股骨、胫骨、腓骨、颅骨、下颌骨、手和脚骨等。
- 病变、结节和结节。例子包括肝脏和肾脏病变、肺结节、淋巴结等。

## 挑战和机遇

在医学图像的识别、分割中遇到的主要挑战是由于诸多因素引起的解剖对象的表现出的形状和外观的变化：
- 传感器噪声/伪影。与任何传感器一样，医疗设备会产生其自身物理传感器和图像形成过程所固有的噪声/伪影。伪影的程度取决于图像模态和成像配置。例如，高剂量 CT 产生的图像具有较少的伪影，反之低剂量 CT 的噪声会很大。此外，金属物体（如植入物）会在 CT 中产生大量伪影。在 MRI 扫描中，由于磁场不均匀、梯度非线性等原因会产生伪影。
- 患者差异和运动。不同的患者表现出不同的体型：胖或瘦、高或矮、成人或儿童等。因此，解剖结构也呈现出不同的形状。此外，患者经历呼吸、心动周期、血液和脑脊液流动、蠕动和吞咽以及自主运动等运动，所有这些都有助于产生不同的图像，导致解剖形状变形。
- 病理学、手术和造影剂。病理学可能导致高度变形的解剖结构，甚至缺失具有不同外观和形状的解剖结构。这使得统计建模非常困难。为了更好地了解病理状况，使用造影剂来更好地可视化解剖形态。不同对比度相位下的图像外观是不同的。最后，手术切除以意想不到的方式完全改变了解剖对象的形状和图像外观。
- 部分扫描和视野。剂量辐射是 CT 中的主要问题。为了尽量减少剂量辐射，只对人体的必要部分进行成像。这会产生部分扫描和狭窄的视野，其中解剖环境被高度削弱或完全消失。结果就是会造成标签或器官丢失或仅部分可见。在 MRI 中，扫描范围通常被最小化以实现快速采集。
- 软组织。内部器官等解剖结构是具有相似特性的软组织。它们（例如肝脏和肾脏）甚至可能相互接触，在它们之间形成非常薄弱的边界。但是，分割的器官必须不重叠。
另一个挑战是临床应用下的速度要求，尽管临床应用中对精度和鲁棒性要求很高，对于速度的要求却并没有放宽。有两个较为有希望的方向：
- 大规模数据库。大型数据库中应当包含患者常见的外观变化
- 解剖背景。不同于自然场景图像，医学图像通常展示出较强的上下文信息，例如有限数量的解剖对象（比如只有一个左心室）、受约束和结构化的背景、不同解剖结构之间的关系、关于姿势参数的强先验信息等。

## 从粗略到精确(Rough to Exact)地对象表示

- 刚体表示
最简单的表示形式就是把物体简化为物体中心点$\mathrm t=[t_x,t_y,t_z]$，完整的刚体表示则应由平移、旋转和放缩参数组成$\theta = [\mathrm t, \mathrm r, \mathrm s]$，当尺度参数是各向同性时，这就退化为一个相似度变换，刚体表示扩展以后就成为仿射表示
- 自由形式的表示
通用自由形式表示，包括基于点的表示，掩膜函数，水平集函数等
- 低维度参数化表示
所谓的统计形状模型(Statistical Shape Model, SSM)就是一种基于主成分分析(Principal Component Analysis, PCA)的点的自由形状低维度参数化表示。其他的还包括M-rep，球谐函数(Spherical Harmonic, SPHARM)，球面小波等

层次化的、RTE的表示会使方法以越来越高的精度逐渐逼近对象本身。一种通用的RTE3D目标表示由一个完全由平移、旋转和放缩参数$\theta = [\vec t, \vec r, \vec s]$指定的刚体部分、一个由顶部PCA系数$\lambda =[\lambda_{1:m}]$指定的低维度PCA形状空间以及一个自由形态非刚体部分组成，这个非刚体部分可以使3D形状$S$，3D网格$M$，3D掩膜或者水平集函数$\phi$
$$
\mathrm O=[\theta;\lambda;S];\quad \mathrm O=[\theta;\lambda;M];\quad \mathrm O=[\theta;\lambda;\phi]\quad \tag{1.1}
$$
PCA形状空间通过线性投影表征一个形状
$$
S=\bar S_0+\sum_{m=1}^M\lambda_m \bar S_m\quad \tag{1.2}
$$
其中$\bar S_0$是平均形状，$\bar S_m$是顶部特征形状，这一PCA形状建模构成了著名的激活形状模型(Activate Shape Model, ASM)的基础。在这种分层表示中，自由形式的部分也可以是粗略到精确的。对于 3D 网格，网格顶点密度可以是一个控制参数，从稀疏到密集。对于水平集函数，它取决于图像分辨率，从粗到细。

## 从简单到复杂(Simple to Complex)的概率模型

后验概率$P(\mathrm O|\mathrm V)$能够完全表征给定体元$\mathrm V$上的对象$\mathrm O$，通过后验概率可以通过计算条件均值(最小均方误差估计)，条件模(最大后验概率估计)或者后验函数推理目标。同理后验分布$P(\mathrm O_{1:n}|\mathrm V)$能够在统计意义上完全表征多个目标$\mathrm O_{1:n}$

### 链式法则

当我们对单个对象进行RTE表示时，所有对象的联合建模会变得极具挑战性且通常很低效。为了解决这一挑战，通用策略是把复杂任务分解成几个简单的小任务，然后采用链式法则计算条件概率的联合概率
$$
P(\mathrm O|\mathrm V)=P(\theta,\lambda,S|\mathrm V)=P(\theta|\mathrm V)P(\lambda|\mathrm V,\theta)P(S|\mathrm V,\theta,\lambda)\tag {1.3}
$$
这就把整个任务分成了三个子任务，第一个任务推理刚体目标，也是使用$P(\theta|\mathrm V)$进行目标检测/识别；第二个任务使用$P(\lambda|\mathrm V,\theta)$同时推理刚体和低维形状模型参数；最后一个任务使用$P(S|\mathrm V,\theta,\lambda)$解决分割问题

实际上对于单目标$\mathrm O$，想要单独对3D姿态部分进行高效地建模是非常困难的，我们也应该使用STC建模方法
$$
P(\theta|\mathrm V)=P(\mathrm{t|V})P(\mathrm{r|V,t})P(\mathrm{s|V,t,r})\tag{1.4}
$$
当处理多个目标时，也可以使用链式法则
$$
P(\mathrm O_{1:n}|\mathrm V)=P(O_1|\mathrm V)P(O_2|\mathrm V,O_1)...P(O_n|\mathrm V,O_{1:n-1})\tag {1.5}
$$

### 贝叶斯法则、概率模型的等效性以及基于能量的模型

根据贝叶斯法则，后验概率正比于相似性和先验概率的乘积
$$
P(\mathrm{O|V})\varpropto P(\mathrm{V|O})P(\mathrm O)\tag{1.6}
$$

基于能量的模型通常最小化能量函数$\varepsilon(\mathrm{O;V})$，它由两部分组成，第一部分将图像与目标联系起来，第二部分表示目标的先验信念
$$
\varepsilon(\mathrm{O;V})=\varepsilon_1(\mathrm{O;V})+\varepsilon_2(\mathrm O)\tag{1.7}
$$
我们令
$$
\varepsilon(\mathrm{O;V})=-\log P(\mathrm{O;V})\quad \varepsilon_1(\mathrm{O;V})=-\log P(\mathrm{V;O})\quad \varepsilon_2(\mathrm O)=-\log P(\mathrm O)
$$
那么概率模型就等价于能量模型了。

### 实用医学图像识别、分割和解析算法

![[./插图/医学图像识别、分割与解析/医学图像计算管线.png]]
<center><font color=silver>图1.1 基于RTE表示和STC建模的医学图像分割通用计算管线</font></center>
常规来说，实用的医学图像识别、分割和解析算法都是上图计算管线的特例，他们实现上的不同取决于以下两方面：
1. 计算架构的改变。
2. 条件概率的建模。

## 使用ML方法的医学图像识别

### 目标检测和上下文信息

